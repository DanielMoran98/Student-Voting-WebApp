{% extends 'base.html.twig' %}

{% block title %}Vote{% endblock %}

{% block body %}
    <h1>Vote</h1>

    {#<table class="table">#}
        {#<tbody>#}
            {#<tr>#}
                {#<th>Id</th>#}
                {#<td>{{ vote.id }}</td>#}
            {#</tr>#}
            {#<tr>#}
                {#<th>Title</th>#}
                {#<td>{{ vote.title }}</td>#}
            {#</tr>#}
            {#<tr>#}
                {#<th>Description</th>#}
                {#<td>{{ vote.description }}</td>#}
            {#</tr>#}
            {#<tr>#}
                {#<th>Image</th>#}
                {#<td>{{ vote.image }}</td>#}
            {#</tr>#}
            {#<tr>#}
                {#<th>ForCount</th>#}
                {#<td>{{ vote.forCount }}</td>#}
            {#</tr>#}
            {#<tr>#}
                {#<th>AgainstCount</th>#}
                {#<td>{{ vote.againstCount }}</td>#}
            {#</tr>#}
            {#<tr>#}
                {#<th>DateCreated</th>#}
                {#<td>{{ vote.dateCreated ? vote.dateCreated|date('Y-m-d H:i:s') : '' }}</td>#}
            {#</tr>#}
            {#<tr>#}
                {#<th>State</th>#}
                {#<td>{{ vote.state }}</td>#}
            {#</tr>#}
        {#</tbody>#}
    {#</table>#}

    <div class="container">
        <div class="row">
            <div class="container">
                <div class="row">
                    <div class="col-sm-2">
                        <!-- Content -->
                    </div>
                    <div class="col-sm-8">
                        <div class="card">
                            {% if vote.image is not null %}
                            <img class="card-img-top" src="{{ vote.image }}" alt="Vote image" style="max-height: 1000px;">
                            {% endif %}
                            <div class="card-body">
                                <h4 class="card-title">{{ vote.title }}</h4>
                                <p class="text-muted">Vote proposed by {{ user }}</p>
                                <p class="card-text">
                                    {{ vote.description }}
                                </p>
                                {% if vote.supporters < 50 and vote.state == 1 %}
                                    <span class="badge ">Current supporters: {{ vote.supporters }}/50</span><br>
                                    <a href="#!" class="btn btn-primary">Support 'Proposition #{{ vote.id }}'</a><br>
                                {% endif %}
                                {% if vote.supporters >= 50 and vote.state == 1 %}
                                    <a href="#!" class="btn btn-success" style="width:49%">Vote for</a>
                                    <a href="#!" class="btn btn-danger" style="width:49%">Vote against</a>
                                {% endif %}
                                {% if vote.state == 0 %}
                                    <div class="alert alert-warning" role="alert">
                                        Unfortunately the vote is finished so you can no longer vote. The results for the vote are available below.
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if vote.state == 0 %}
                        <div class="card" style="padding:25px;">
                            <h3>Results</h3>
                            <canvas id="myChart"></canvas>
                            <br><br>
                            <div class="row" style="text-align: center;">
                                <div class="col-sm-6">
                                    For: {{ vote.forCount }}
                                </div>
                                <div class="col-sm-6">
                                    Against: {{ vote.againstCount }}
                                </div>
                            </div>

                        </div>
                        {% endif %}
                    </div>
                    <div class="col-sm-2">
                        <a href="{{ path('vote_index') }}">BACK TO LIST</a>
                        <BR>
                        <a href="{{ path('vote_edit', {'id': vote.id}) }}">EDIT</a>
                        {{ include('vote/_delete_form.html.twig') }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        new Chart(document.getElementById("myChart"), {
            type: 'bar',
            data: {
                labels: ["For", "Against"],
                datasets: [
                    {
                        label: "Votes",
                        backgroundColor: ["#28a745", "#dc3545"],
                        data: [{{ vote.forCount }},{{ vote.againstCount }},0]
                    }
                ]
            },
            options: {
                legend: { display: false },
                title: {
                    display: true,
                    text: 'Vote results for Proposition #{{ vote.id }}'
                }
            }
        });
    </script>
{% endblock %}
